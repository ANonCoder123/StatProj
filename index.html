<!DOCTYPE html>
<html>
<head>
  <title>Experiment</title>
</head>
<body>
  <h1>Participant Registration</h1>
  <form id="registrationForm">
    <!-- form fields -->

    <input type="submit" value="Submit">
  </form>

  <!-- Include the Firebase JavaScript SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  
  <script>
    // Initialize Firebase with your configuration
    const firebaseConfig = {
      // your Firebase config
    };

    firebase.initializeApp(firebaseConfig);

    // Get a reference to the Firebase database
    const database = firebase.database();

    // Add your form submission and participant data storage logic here
    document.getElementById("registrationForm").addEventListener("submit", function(event) {
      event.preventDefault();

      // Retrieve form values
      var name = document.getElementById("name").value;
      var age = document.getElementById("age").value;
      var gender = document.getElementById("gender").value;
      var race = document.getElementById("race").value;
      var period = document.getElementById("period").value;

      // Check if the user is authenticated when the form is submitted
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          // User is authenticated, proceed with storing participant data

          // Retrieve the ID token
          user.getIdToken()
            .then(function(token) {
              // Perform the write operation, including the authentication token in the request
              firebase.database()
                .ref("participants")
                .push()
                .set(
                  {
                    name: name,
                    age: age,
                    gender: gender,
                    race: race,
                    period: period
                  },
                  { headers: { Authorization: `Bearer ${token}` } }
                )
                .then(() => {
                  console.log("Write operation successful");
                  // Redirect to the trust rating questions page for the specific period
                  window.location.href = "trust-rating.html?period=" + period;
                })
                .catch((error) => {
                  console.error("Error storing participant data:", error);
                });
            })
            .catch(function(error) {
              console.error("Error retrieving ID token:", error);
            });
        } else {
          // User is not authenticated, handle accordingly
          console.log("User is not authenticated");
        }
      });
    });
  </script>
</body>
</html>
